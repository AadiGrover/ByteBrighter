{"ast":null,"code":"import { toast } from \"react-hot-toast\";\nimport { studentEndpoints } from \"../apis\";\nimport { apiConnector } from \"../apiconnector\";\nimport { setPaymentLoading } from \"../../slices/courseSlice\";\nimport { resetCart } from \"../../slices/cartSlice\";\nconst {\n  COURSE_PAYMENT_API,\n  COURSE_VERIFY_API,\n  SEND_PAYMENT_SUCCESS_EMAIL_API\n} = studentEndpoints;\nfunction loadScript(src) {\n  return new Promise(resolve => {\n    const script = document.createElement(\"script\");\n    script.src = src;\n    script.onload = () => {\n      resolve(true);\n    };\n    script.onerror = () => {\n      resolve(false);\n    };\n    document.body.appendChild(script);\n  });\n}\nexport async function buyCourse(token, courses, userDetails, navigate, dispatch) {\n  const toastId = toast.loading(\"Loading...\");\n  try {\n    //load the script\n    const res = await loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");\n    if (!res) {\n      toast.error(\"RazorPay SDK failed to load\");\n      return;\n    }\n\n    //initiate the order\n    const orderResponse = await apiConnector(\"POST\", COURSE_PAYMENT_API, {\n      courses\n    }, {\n      Authorization: `Bearer ${token}`\n    });\n    if (!orderResponse.data.success) {\n      throw new Error(orderResponse.data.message);\n    }\n    console.log(\"PRINTING orderResponse\", orderResponse);\n    //options\n    const options = {\n      key: process.env.RAZORPAY_KEY,\n      currency: orderResponse.data.message.currency,\n      amount: `${orderResponse.data.message.amount}`,\n      order_id: orderResponse.data.message.id,\n      name: \"ByteBrighter\",\n      description: \"Thank You for Purchasing the Course\",\n      prefill: {\n        name: `${userDetails.firstName}`,\n        email: userDetails.email\n      },\n      handler: function (response) {\n        //send successful wala mail\n        sendPaymentSuccessEmail(response, orderResponse.data.message.amount, token);\n        //verifyPayment\n        verifyPayment({\n          ...response,\n          courses\n        }, token, navigate, dispatch);\n      }\n    };\n    const paymentObject = new window.Razorpay(options);\n    paymentObject.open();\n    paymentObject.on(\"payment.failed\", function (response) {\n      toast.error(\"oops, payment failed\");\n      console.log(response.error);\n    });\n  } catch (error) {\n    console.log(\"PAYMENT API ERROR.....\", error);\n    toast.error(\"Could not make Payment\");\n  }\n  toast.dismiss(toastId);\n}\nasync function sendPaymentSuccessEmail(response, amount, token) {\n  try {\n    await apiConnector(\"POST\", SEND_PAYMENT_SUCCESS_EMAIL_API, {\n      orderId: response.razorpay_order_id,\n      paymentId: response.razorpay_payment_id,\n      amount\n    }, {\n      Authorization: `Bearer ${token}`\n    });\n  } catch (error) {\n    console.log(\"PAYMENT SUCCESS EMAIL ERROR....\", error);\n  }\n}\n\n//verify payment\nasync function verifyPayment(bodyData, token, navigate, dispatch) {\n  const toastId = toast.loading(\"Verifying Payment....\");\n  dispatch(setPaymentLoading(true));\n  try {\n    const response = await apiConnector(\"POST\", COURSE_VERIFY_API, bodyData, {\n      Authorization: `Bearer ${token}`\n    });\n    if (!response.data.success) {\n      throw new Error(response.data.message);\n    }\n    toast.success(\"Payment Successful, ypou are addded to the course\");\n    navigate(\"/dashboard/enrolled-courses\");\n    dispatch(resetCart());\n  } catch (error) {\n    console.log(\"PAYMENT VERIFY ERROR....\", error);\n    toast.error(\"Could not verify Payment\");\n  }\n  toast.dismiss(toastId);\n  dispatch(setPaymentLoading(false));\n}","map":{"version":3,"names":["toast","studentEndpoints","apiConnector","setPaymentLoading","resetCart","COURSE_PAYMENT_API","COURSE_VERIFY_API","SEND_PAYMENT_SUCCESS_EMAIL_API","loadScript","src","Promise","resolve","script","document","createElement","onload","onerror","body","appendChild","buyCourse","token","courses","userDetails","navigate","dispatch","toastId","loading","res","error","orderResponse","Authorization","data","success","Error","message","console","log","options","key","process","env","RAZORPAY_KEY","currency","amount","order_id","id","name","description","prefill","firstName","email","handler","response","sendPaymentSuccessEmail","verifyPayment","paymentObject","window","Razorpay","open","on","dismiss","orderId","razorpay_order_id","paymentId","razorpay_payment_id","bodyData"],"sources":["/Users/lecher/Desktop/ByteBrighter/frontend/src/services/operations/studentFeaturesAPI.js"],"sourcesContent":["import { toast } from \"react-hot-toast\";\r\nimport { studentEndpoints } from \"../apis\";\r\nimport { apiConnector } from \"../apiconnector\";\r\nimport { setPaymentLoading } from \"../../slices/courseSlice\";\r\nimport { resetCart } from \"../../slices/cartSlice\";\r\n\r\n\r\nconst {COURSE_PAYMENT_API, COURSE_VERIFY_API, SEND_PAYMENT_SUCCESS_EMAIL_API} = studentEndpoints;\r\n\r\nfunction loadScript(src) {\r\n    return new Promise((resolve) => {\r\n        const script = document.createElement(\"script\");\r\n        script.src = src;\r\n\r\n        script.onload = () => {\r\n            resolve(true);\r\n        }\r\n        script.onerror= () =>{\r\n            resolve(false);\r\n        }\r\n        document.body.appendChild(script);\r\n    })\r\n}\r\n\r\n\r\nexport async function buyCourse(token, courses, userDetails, navigate, dispatch) {\r\n    const toastId = toast.loading(\"Loading...\");\r\n    try{\r\n        //load the script\r\n        const res = await loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");\r\n\r\n        if(!res) {\r\n            toast.error(\"RazorPay SDK failed to load\");\r\n            return;\r\n        }\r\n\r\n        //initiate the order\r\n        const orderResponse = await apiConnector(\"POST\", COURSE_PAYMENT_API, \r\n                                {courses},\r\n                                {\r\n                                    Authorization: `Bearer ${token}`,\r\n                                })\r\n\r\n        if(!orderResponse.data.success) {\r\n            throw new Error(orderResponse.data.message);\r\n        }\r\n        console.log(\"PRINTING orderResponse\", orderResponse);\r\n        //options\r\n        const options = {\r\n            key: process.env.RAZORPAY_KEY,\r\n            currency: orderResponse.data.message.currency,\r\n            amount: `${orderResponse.data.message.amount}`,\r\n            order_id:orderResponse.data.message.id,\r\n            name:\"ByteBrighter\",\r\n            description: \"Thank You for Purchasing the Course\",\r\n            prefill: {\r\n                name:`${userDetails.firstName}`,\r\n                email:userDetails.email\r\n            },\r\n            handler: function(response) {\r\n                //send successful wala mail\r\n                sendPaymentSuccessEmail(response, orderResponse.data.message.amount,token );\r\n                //verifyPayment\r\n                verifyPayment({...response, courses}, token, navigate, dispatch);\r\n            }\r\n        }\r\n        const paymentObject = new window.Razorpay(options);\r\n        paymentObject.open();\r\n        paymentObject.on(\"payment.failed\", function(response) {\r\n            toast.error(\"oops, payment failed\");\r\n            console.log(response.error);\r\n        })\r\n\r\n    }\r\n    catch(error) {\r\n        console.log(\"PAYMENT API ERROR.....\", error);\r\n        toast.error(\"Could not make Payment\");\r\n    }\r\n    toast.dismiss(toastId);\r\n}\r\n\r\nasync function sendPaymentSuccessEmail(response, amount, token) {\r\n    try{\r\n        await apiConnector(\"POST\", SEND_PAYMENT_SUCCESS_EMAIL_API, {\r\n            orderId: response.razorpay_order_id,\r\n            paymentId: response.razorpay_payment_id,\r\n            amount,\r\n        },{\r\n            Authorization: `Bearer ${token}`\r\n        })\r\n    }\r\n    catch(error) {\r\n        console.log(\"PAYMENT SUCCESS EMAIL ERROR....\", error);\r\n    }\r\n}\r\n\r\n//verify payment\r\nasync function verifyPayment(bodyData, token, navigate, dispatch) {\r\n    const toastId = toast.loading(\"Verifying Payment....\");\r\n    dispatch(setPaymentLoading(true));\r\n    try{\r\n        const response  = await apiConnector(\"POST\", COURSE_VERIFY_API, bodyData, {\r\n            Authorization:`Bearer ${token}`,\r\n        })\r\n\r\n        if(!response.data.success) {\r\n            throw new Error(response.data.message);\r\n        }\r\n        toast.success(\"Payment Successful, ypou are addded to the course\");\r\n        navigate(\"/dashboard/enrolled-courses\");\r\n        dispatch(resetCart());\r\n    }   \r\n    catch(error) {\r\n        console.log(\"PAYMENT VERIFY ERROR....\", error);\r\n        toast.error(\"Could not verify Payment\");\r\n    }\r\n    toast.dismiss(toastId);\r\n    dispatch(setPaymentLoading(false));\r\n}"],"mappings":"AAAA,SAASA,KAAK,QAAQ,iBAAiB;AACvC,SAASC,gBAAgB,QAAQ,SAAS;AAC1C,SAASC,YAAY,QAAQ,iBAAiB;AAC9C,SAASC,iBAAiB,QAAQ,0BAA0B;AAC5D,SAASC,SAAS,QAAQ,wBAAwB;AAGlD,MAAM;EAACC,kBAAkB;EAAEC,iBAAiB;EAAEC;AAA8B,CAAC,GAAGN,gBAAgB;AAEhG,SAASO,UAAUA,CAACC,GAAG,EAAE;EACrB,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAK;IAC5B,MAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;IAC/CF,MAAM,CAACH,GAAG,GAAGA,GAAG;IAEhBG,MAAM,CAACG,MAAM,GAAG,MAAM;MAClBJ,OAAO,CAAC,IAAI,CAAC;IACjB,CAAC;IACDC,MAAM,CAACI,OAAO,GAAE,MAAK;MACjBL,OAAO,CAAC,KAAK,CAAC;IAClB,CAAC;IACDE,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACN,MAAM,CAAC;EACrC,CAAC,CAAC;AACN;AAGA,OAAO,eAAeO,SAASA,CAACC,KAAK,EAAEC,OAAO,EAAEC,WAAW,EAAEC,QAAQ,EAAEC,QAAQ,EAAE;EAC7E,MAAMC,OAAO,GAAGzB,KAAK,CAAC0B,OAAO,CAAC,YAAY,CAAC;EAC3C,IAAG;IACC;IACA,MAAMC,GAAG,GAAG,MAAMnB,UAAU,CAAC,8CAA8C,CAAC;IAE5E,IAAG,CAACmB,GAAG,EAAE;MACL3B,KAAK,CAAC4B,KAAK,CAAC,6BAA6B,CAAC;MAC1C;IACJ;;IAEA;IACA,MAAMC,aAAa,GAAG,MAAM3B,YAAY,CAAC,MAAM,EAAEG,kBAAkB,EAC3C;MAACgB;IAAO,CAAC,EACT;MACIS,aAAa,EAAG,UAASV,KAAM;IACnC,CAAC,CAAC;IAE1B,IAAG,CAACS,aAAa,CAACE,IAAI,CAACC,OAAO,EAAE;MAC5B,MAAM,IAAIC,KAAK,CAACJ,aAAa,CAACE,IAAI,CAACG,OAAO,CAAC;IAC/C;IACAC,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEP,aAAa,CAAC;IACpD;IACA,MAAMQ,OAAO,GAAG;MACZC,GAAG,EAAEC,OAAO,CAACC,GAAG,CAACC,YAAY;MAC7BC,QAAQ,EAAEb,aAAa,CAACE,IAAI,CAACG,OAAO,CAACQ,QAAQ;MAC7CC,MAAM,EAAG,GAAEd,aAAa,CAACE,IAAI,CAACG,OAAO,CAACS,MAAO,EAAC;MAC9CC,QAAQ,EAACf,aAAa,CAACE,IAAI,CAACG,OAAO,CAACW,EAAE;MACtCC,IAAI,EAAC,cAAc;MACnBC,WAAW,EAAE,qCAAqC;MAClDC,OAAO,EAAE;QACLF,IAAI,EAAE,GAAExB,WAAW,CAAC2B,SAAU,EAAC;QAC/BC,KAAK,EAAC5B,WAAW,CAAC4B;MACtB,CAAC;MACDC,OAAO,EAAE,SAAAA,CAASC,QAAQ,EAAE;QACxB;QACAC,uBAAuB,CAACD,QAAQ,EAAEvB,aAAa,CAACE,IAAI,CAACG,OAAO,CAACS,MAAM,EAACvB,KAAK,CAAE;QAC3E;QACAkC,aAAa,CAAC;UAAC,GAAGF,QAAQ;UAAE/B;QAAO,CAAC,EAAED,KAAK,EAAEG,QAAQ,EAAEC,QAAQ,CAAC;MACpE;IACJ,CAAC;IACD,MAAM+B,aAAa,GAAG,IAAIC,MAAM,CAACC,QAAQ,CAACpB,OAAO,CAAC;IAClDkB,aAAa,CAACG,IAAI,EAAE;IACpBH,aAAa,CAACI,EAAE,CAAC,gBAAgB,EAAE,UAASP,QAAQ,EAAE;MAClDpD,KAAK,CAAC4B,KAAK,CAAC,sBAAsB,CAAC;MACnCO,OAAO,CAACC,GAAG,CAACgB,QAAQ,CAACxB,KAAK,CAAC;IAC/B,CAAC,CAAC;EAEN,CAAC,CACD,OAAMA,KAAK,EAAE;IACTO,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAER,KAAK,CAAC;IAC5C5B,KAAK,CAAC4B,KAAK,CAAC,wBAAwB,CAAC;EACzC;EACA5B,KAAK,CAAC4D,OAAO,CAACnC,OAAO,CAAC;AAC1B;AAEA,eAAe4B,uBAAuBA,CAACD,QAAQ,EAAET,MAAM,EAAEvB,KAAK,EAAE;EAC5D,IAAG;IACC,MAAMlB,YAAY,CAAC,MAAM,EAAEK,8BAA8B,EAAE;MACvDsD,OAAO,EAAET,QAAQ,CAACU,iBAAiB;MACnCC,SAAS,EAAEX,QAAQ,CAACY,mBAAmB;MACvCrB;IACJ,CAAC,EAAC;MACEb,aAAa,EAAG,UAASV,KAAM;IACnC,CAAC,CAAC;EACN,CAAC,CACD,OAAMQ,KAAK,EAAE;IACTO,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAER,KAAK,CAAC;EACzD;AACJ;;AAEA;AACA,eAAe0B,aAAaA,CAACW,QAAQ,EAAE7C,KAAK,EAAEG,QAAQ,EAAEC,QAAQ,EAAE;EAC9D,MAAMC,OAAO,GAAGzB,KAAK,CAAC0B,OAAO,CAAC,uBAAuB,CAAC;EACtDF,QAAQ,CAACrB,iBAAiB,CAAC,IAAI,CAAC,CAAC;EACjC,IAAG;IACC,MAAMiD,QAAQ,GAAI,MAAMlD,YAAY,CAAC,MAAM,EAAEI,iBAAiB,EAAE2D,QAAQ,EAAE;MACtEnC,aAAa,EAAE,UAASV,KAAM;IAClC,CAAC,CAAC;IAEF,IAAG,CAACgC,QAAQ,CAACrB,IAAI,CAACC,OAAO,EAAE;MACvB,MAAM,IAAIC,KAAK,CAACmB,QAAQ,CAACrB,IAAI,CAACG,OAAO,CAAC;IAC1C;IACAlC,KAAK,CAACgC,OAAO,CAAC,mDAAmD,CAAC;IAClET,QAAQ,CAAC,6BAA6B,CAAC;IACvCC,QAAQ,CAACpB,SAAS,EAAE,CAAC;EACzB,CAAC,CACD,OAAMwB,KAAK,EAAE;IACTO,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAER,KAAK,CAAC;IAC9C5B,KAAK,CAAC4B,KAAK,CAAC,0BAA0B,CAAC;EAC3C;EACA5B,KAAK,CAAC4D,OAAO,CAACnC,OAAO,CAAC;EACtBD,QAAQ,CAACrB,iBAAiB,CAAC,KAAK,CAAC,CAAC;AACtC"},"metadata":{},"sourceType":"module","externalDependencies":[]}