{"ast":null,"code":"import _regeneratorRuntime from\"/Users/lecher/Desktop/ByteBrighter/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/lecher/Desktop/ByteBrighter/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/lecher/Desktop/ByteBrighter/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{toast}from\"react-hot-toast\";import{studentEndpoints}from\"../apis\";import{apiConnector}from\"../apiconnector\";import{setPaymentLoading}from\"../../slices/courseSlice\";import{resetCart}from\"../../slices/cartSlice\";var COURSE_PAYMENT_API=studentEndpoints.COURSE_PAYMENT_API,COURSE_VERIFY_API=studentEndpoints.COURSE_VERIFY_API,SEND_PAYMENT_SUCCESS_EMAIL_API=studentEndpoints.SEND_PAYMENT_SUCCESS_EMAIL_API;function loadScript(src){return new Promise(function(resolve){var script=document.createElement(\"script\");script.src=src;script.onload=function(){resolve(true);};script.onerror=function(){resolve(false);};document.body.appendChild(script);});}export function buyCourse(_x,_x2,_x3,_x4,_x5){return _buyCourse.apply(this,arguments);}function _buyCourse(){_buyCourse=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(token,courses,userDetails,navigate,dispatch){var toastId,res,orderResponse,options,paymentObject;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:toastId=toast.loading(\"Loading...\");_context.prev=1;_context.next=4;return loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");case 4:res=_context.sent;if(res){_context.next=8;break;}toast.error(\"RazorPay SDK failed to load\");return _context.abrupt(\"return\");case 8:_context.next=10;return apiConnector(\"POST\",COURSE_PAYMENT_API,{courses:courses},{Authorization:\"Bearer \".concat(token)});case 10:orderResponse=_context.sent;if(orderResponse.data.success){_context.next=13;break;}throw new Error(orderResponse.data.message);case 13:console.log(\"PRINTING orderResponse\",orderResponse);//options\noptions={key:process.env.RAZORPAY_KEY,currency:orderResponse.data.message.currency,amount:\"\".concat(orderResponse.data.message.amount),order_id:orderResponse.data.message.id,name:\"ByteBrighter\",description:\"Thank You for Purchasing the Course\",prefill:{name:\"\".concat(userDetails.firstName),email:userDetails.email},handler:function handler(response){//send successful wala mail\nsendPaymentSuccessEmail(response,orderResponse.data.message.amount,token);//verifyPayment\nverifyPayment(_objectSpread(_objectSpread({},response),{},{courses:courses}),token,navigate,dispatch);}};paymentObject=new window.Razorpay(options);paymentObject.open();paymentObject.on(\"payment.failed\",function(response){toast.error(\"oops, payment failed\");console.log(response.error);});_context.next=24;break;case 20:_context.prev=20;_context.t0=_context[\"catch\"](1);console.log(\"PAYMENT API ERROR.....\",_context.t0);toast.error(\"Could not make Payment\");case 24:toast.dismiss(toastId);case 25:case\"end\":return _context.stop();}},_callee,null,[[1,20]]);}));return _buyCourse.apply(this,arguments);}function sendPaymentSuccessEmail(_x6,_x7,_x8){return _sendPaymentSuccessEmail.apply(this,arguments);}//verify payment\nfunction _sendPaymentSuccessEmail(){_sendPaymentSuccessEmail=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(response,amount,token){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return apiConnector(\"POST\",SEND_PAYMENT_SUCCESS_EMAIL_API,{orderId:response.razorpay_order_id,paymentId:response.razorpay_payment_id,amount:amount},{Authorization:\"Bearer \".concat(token)});case 3:_context2.next=8;break;case 5:_context2.prev=5;_context2.t0=_context2[\"catch\"](0);console.log(\"PAYMENT SUCCESS EMAIL ERROR....\",_context2.t0);case 8:case\"end\":return _context2.stop();}},_callee2,null,[[0,5]]);}));return _sendPaymentSuccessEmail.apply(this,arguments);}function verifyPayment(_x9,_x10,_x11,_x12){return _verifyPayment.apply(this,arguments);}function _verifyPayment(){_verifyPayment=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(bodyData,token,navigate,dispatch){var toastId,response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:toastId=toast.loading(\"Verifying Payment....\");dispatch(setPaymentLoading(true));_context3.prev=2;_context3.next=5;return apiConnector(\"POST\",COURSE_VERIFY_API,bodyData,{Authorization:\"Bearer \".concat(token)});case 5:response=_context3.sent;if(response.data.success){_context3.next=8;break;}throw new Error(response.data.message);case 8:toast.success(\"Payment Successful, ypou are addded to the course\");navigate(\"/dashboard/enrolled-courses\");dispatch(resetCart());_context3.next=17;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](2);console.log(\"PAYMENT VERIFY ERROR....\",_context3.t0);toast.error(\"Could not verify Payment\");case 17:toast.dismiss(toastId);dispatch(setPaymentLoading(false));case 19:case\"end\":return _context3.stop();}},_callee3,null,[[2,13]]);}));return _verifyPayment.apply(this,arguments);}","map":{"version":3,"names":["toast","studentEndpoints","apiConnector","setPaymentLoading","resetCart","COURSE_PAYMENT_API","COURSE_VERIFY_API","SEND_PAYMENT_SUCCESS_EMAIL_API","loadScript","src","Promise","resolve","script","document","createElement","onload","onerror","body","appendChild","buyCourse","_x","_x2","_x3","_x4","_x5","_buyCourse","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","token","courses","userDetails","navigate","dispatch","toastId","res","orderResponse","options","paymentObject","wrap","_callee$","_context","prev","next","loading","sent","error","abrupt","Authorization","concat","data","success","Error","message","console","log","key","process","env","RAZORPAY_KEY","currency","amount","order_id","id","name","description","prefill","firstName","email","handler","response","sendPaymentSuccessEmail","verifyPayment","_objectSpread","window","Razorpay","open","on","t0","dismiss","stop","_x6","_x7","_x8","_sendPaymentSuccessEmail","_callee2","_callee2$","_context2","orderId","razorpay_order_id","paymentId","razorpay_payment_id","_x9","_x10","_x11","_x12","_verifyPayment","_callee3","bodyData","_callee3$","_context3"],"sources":["/Users/lecher/Desktop/ByteBrighter/frontend/src/services/operations/studentFeaturesAPI.js"],"sourcesContent":["import { toast } from \"react-hot-toast\";\r\nimport { studentEndpoints } from \"../apis\";\r\nimport { apiConnector } from \"../apiconnector\";\r\nimport { setPaymentLoading } from \"../../slices/courseSlice\";\r\nimport { resetCart } from \"../../slices/cartSlice\";\r\n\r\n\r\nconst {COURSE_PAYMENT_API, COURSE_VERIFY_API, SEND_PAYMENT_SUCCESS_EMAIL_API} = studentEndpoints;\r\n\r\nfunction loadScript(src) {\r\n    return new Promise((resolve) => {\r\n        const script = document.createElement(\"script\");\r\n        script.src = src;\r\n\r\n        script.onload = () => {\r\n            resolve(true);\r\n        }\r\n        script.onerror= () =>{\r\n            resolve(false);\r\n        }\r\n        document.body.appendChild(script);\r\n    })\r\n}\r\n\r\n\r\nexport async function buyCourse(token, courses, userDetails, navigate, dispatch) {\r\n    const toastId = toast.loading(\"Loading...\");\r\n    try{\r\n        //load the script\r\n        const res = await loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");\r\n\r\n        if(!res) {\r\n            toast.error(\"RazorPay SDK failed to load\");\r\n            return;\r\n        }\r\n\r\n        //initiate the order\r\n        const orderResponse = await apiConnector(\"POST\", COURSE_PAYMENT_API, \r\n                                {courses},\r\n                                {\r\n                                    Authorization: `Bearer ${token}`,\r\n                                })\r\n\r\n        if(!orderResponse.data.success) {\r\n            throw new Error(orderResponse.data.message);\r\n        }\r\n        console.log(\"PRINTING orderResponse\", orderResponse);\r\n        //options\r\n        const options = {\r\n            key: process.env.RAZORPAY_KEY,\r\n            currency: orderResponse.data.message.currency,\r\n            amount: `${orderResponse.data.message.amount}`,\r\n            order_id:orderResponse.data.message.id,\r\n            name:\"ByteBrighter\",\r\n            description: \"Thank You for Purchasing the Course\",\r\n            prefill: {\r\n                name:`${userDetails.firstName}`,\r\n                email:userDetails.email\r\n            },\r\n            handler: function(response) {\r\n                //send successful wala mail\r\n                sendPaymentSuccessEmail(response, orderResponse.data.message.amount,token );\r\n                //verifyPayment\r\n                verifyPayment({...response, courses}, token, navigate, dispatch);\r\n            }\r\n        }\r\n        const paymentObject = new window.Razorpay(options);\r\n        paymentObject.open();\r\n        paymentObject.on(\"payment.failed\", function(response) {\r\n            toast.error(\"oops, payment failed\");\r\n            console.log(response.error);\r\n        })\r\n\r\n    }\r\n    catch(error) {\r\n        console.log(\"PAYMENT API ERROR.....\", error);\r\n        toast.error(\"Could not make Payment\");\r\n    }\r\n    toast.dismiss(toastId);\r\n}\r\n\r\nasync function sendPaymentSuccessEmail(response, amount, token) {\r\n    try{\r\n        await apiConnector(\"POST\", SEND_PAYMENT_SUCCESS_EMAIL_API, {\r\n            orderId: response.razorpay_order_id,\r\n            paymentId: response.razorpay_payment_id,\r\n            amount,\r\n        },{\r\n            Authorization: `Bearer ${token}`\r\n        })\r\n    }\r\n    catch(error) {\r\n        console.log(\"PAYMENT SUCCESS EMAIL ERROR....\", error);\r\n    }\r\n}\r\n\r\n//verify payment\r\nasync function verifyPayment(bodyData, token, navigate, dispatch) {\r\n    const toastId = toast.loading(\"Verifying Payment....\");\r\n    dispatch(setPaymentLoading(true));\r\n    try{\r\n        const response  = await apiConnector(\"POST\", COURSE_VERIFY_API, bodyData, {\r\n            Authorization:`Bearer ${token}`,\r\n        })\r\n\r\n        if(!response.data.success) {\r\n            throw new Error(response.data.message);\r\n        }\r\n        toast.success(\"Payment Successful, ypou are addded to the course\");\r\n        navigate(\"/dashboard/enrolled-courses\");\r\n        dispatch(resetCart());\r\n    }   \r\n    catch(error) {\r\n        console.log(\"PAYMENT VERIFY ERROR....\", error);\r\n        toast.error(\"Could not verify Payment\");\r\n    }\r\n    toast.dismiss(toastId);\r\n    dispatch(setPaymentLoading(false));\r\n}"],"mappings":"kZAAA,OAASA,KAAK,KAAQ,iBAAiB,CACvC,OAASC,gBAAgB,KAAQ,SAAS,CAC1C,OAASC,YAAY,KAAQ,iBAAiB,CAC9C,OAASC,iBAAiB,KAAQ,0BAA0B,CAC5D,OAASC,SAAS,KAAQ,wBAAwB,CAGlD,GAAO,CAAAC,kBAAkB,CAAuDJ,gBAAgB,CAAzFI,kBAAkB,CAAEC,iBAAiB,CAAoCL,gBAAgB,CAArEK,iBAAiB,CAAEC,8BAA8B,CAAIN,gBAAgB,CAAlDM,8BAA8B,CAE5E,QAAS,CAAAC,UAAUA,CAACC,GAAG,CAAE,CACrB,MAAO,IAAI,CAAAC,OAAO,CAAC,SAACC,OAAO,CAAK,CAC5B,GAAM,CAAAC,MAAM,CAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CAC/CF,MAAM,CAACH,GAAG,CAAGA,GAAG,CAEhBG,MAAM,CAACG,MAAM,CAAG,UAAM,CAClBJ,OAAO,CAAC,IAAI,CAAC,CACjB,CAAC,CACDC,MAAM,CAACI,OAAO,CAAE,UAAK,CACjBL,OAAO,CAAC,KAAK,CAAC,CAClB,CAAC,CACDE,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACN,MAAM,CAAC,CACrC,CAAC,CAAC,CACN,CAGA,eAAsB,CAAAO,SAASA,CAAAC,EAAA,CAAAC,GAAA,CAAAC,GAAA,CAAAC,GAAA,CAAAC,GAAA,SAAAC,UAAA,CAAAC,KAAA,MAAAC,SAAA,GAsD9B,SAAAF,WAAA,EAAAA,UAAA,CAAAG,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAtDM,SAAAC,QAAyBC,KAAK,CAAEC,OAAO,CAAEC,WAAW,CAAEC,QAAQ,CAAEC,QAAQ,MAAAC,OAAA,CAAAC,GAAA,CAAAC,aAAA,CAAAC,OAAA,CAAAC,aAAA,QAAAZ,mBAAA,GAAAa,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SACrET,OAAO,CAAGrC,KAAK,CAAC+C,OAAO,CAAC,YAAY,CAAC,CAAAH,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,SAGrB,CAAAtC,UAAU,CAAC,8CAA8C,CAAC,QAAtE8B,GAAG,CAAAM,QAAA,CAAAI,IAAA,IAELV,GAAG,EAAAM,QAAA,CAAAE,IAAA,UACH9C,KAAK,CAACiD,KAAK,CAAC,6BAA6B,CAAC,CAAC,OAAAL,QAAA,CAAAM,MAAA,kBAAAN,QAAA,CAAAE,IAAA,UAKnB,CAAA5C,YAAY,CAAC,MAAM,CAAEG,kBAAkB,CAC3C,CAAC4B,OAAO,CAAPA,OAAO,CAAC,CACT,CACIkB,aAAa,WAAAC,MAAA,CAAYpB,KAAK,CAClC,CAAC,CAAC,SAJpBO,aAAa,CAAAK,QAAA,CAAAI,IAAA,IAMfT,aAAa,CAACc,IAAI,CAACC,OAAO,EAAAV,QAAA,CAAAE,IAAA,gBACpB,IAAI,CAAAS,KAAK,CAAChB,aAAa,CAACc,IAAI,CAACG,OAAO,CAAC,SAE/CC,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAEnB,aAAa,CAAC,CACpD;AACMC,OAAO,CAAG,CACZmB,GAAG,CAAEC,OAAO,CAACC,GAAG,CAACC,YAAY,CAC7BC,QAAQ,CAAExB,aAAa,CAACc,IAAI,CAACG,OAAO,CAACO,QAAQ,CAC7CC,MAAM,IAAAZ,MAAA,CAAKb,aAAa,CAACc,IAAI,CAACG,OAAO,CAACQ,MAAM,CAAE,CAC9CC,QAAQ,CAAC1B,aAAa,CAACc,IAAI,CAACG,OAAO,CAACU,EAAE,CACtCC,IAAI,CAAC,cAAc,CACnBC,WAAW,CAAE,qCAAqC,CAClDC,OAAO,CAAE,CACLF,IAAI,IAAAf,MAAA,CAAIlB,WAAW,CAACoC,SAAS,CAAE,CAC/BC,KAAK,CAACrC,WAAW,CAACqC,KACtB,CAAC,CACDC,OAAO,CAAE,SAAAA,QAASC,QAAQ,CAAE,CACxB;AACAC,uBAAuB,CAACD,QAAQ,CAAElC,aAAa,CAACc,IAAI,CAACG,OAAO,CAACQ,MAAM,CAAChC,KAAK,CAAE,CAC3E;AACA2C,aAAa,CAAAC,aAAA,CAAAA,aAAA,IAAKH,QAAQ,MAAExC,OAAO,CAAPA,OAAO,GAAGD,KAAK,CAAEG,QAAQ,CAAEC,QAAQ,CAAC,CACpE,CACJ,CAAC,CACKK,aAAa,CAAG,GAAI,CAAAoC,MAAM,CAACC,QAAQ,CAACtC,OAAO,CAAC,CAClDC,aAAa,CAACsC,IAAI,EAAE,CACpBtC,aAAa,CAACuC,EAAE,CAAC,gBAAgB,CAAE,SAASP,QAAQ,CAAE,CAClDzE,KAAK,CAACiD,KAAK,CAAC,sBAAsB,CAAC,CACnCQ,OAAO,CAACC,GAAG,CAACe,QAAQ,CAACxB,KAAK,CAAC,CAC/B,CAAC,CAAC,CAAAL,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAC,IAAA,IAAAD,QAAA,CAAAqC,EAAA,CAAArC,QAAA,aAIFa,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAAd,QAAA,CAAAqC,EAAA,CAAQ,CAC5CjF,KAAK,CAACiD,KAAK,CAAC,wBAAwB,CAAC,CAAC,QAE1CjD,KAAK,CAACkF,OAAO,CAAC7C,OAAO,CAAC,CAAC,yBAAAO,QAAA,CAAAuC,IAAA,MAAApD,OAAA,iBAC1B,UAAAN,UAAA,CAAAC,KAAA,MAAAC,SAAA,WAEc,CAAA+C,uBAAuBA,CAAAU,GAAA,CAAAC,GAAA,CAAAC,GAAA,SAAAC,wBAAA,CAAA7D,KAAA,MAAAC,SAAA,GAetC;AAAA,SAAA4D,yBAAA,EAAAA,wBAAA,CAAA3D,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAfA,SAAA0D,SAAuCf,QAAQ,CAAET,MAAM,CAAEhC,KAAK,SAAAH,mBAAA,GAAAa,IAAA,UAAA+C,UAAAC,SAAA,iBAAAA,SAAA,CAAA7C,IAAA,CAAA6C,SAAA,CAAA5C,IAAA,SAAA4C,SAAA,CAAA7C,IAAA,GAAA6C,SAAA,CAAA5C,IAAA,SAEhD,CAAA5C,YAAY,CAAC,MAAM,CAAEK,8BAA8B,CAAE,CACvDoF,OAAO,CAAElB,QAAQ,CAACmB,iBAAiB,CACnCC,SAAS,CAAEpB,QAAQ,CAACqB,mBAAmB,CACvC9B,MAAM,CAANA,MACJ,CAAC,CAAC,CACEb,aAAa,WAAAC,MAAA,CAAYpB,KAAK,CAClC,CAAC,CAAC,QAAA0D,SAAA,CAAA5C,IAAA,gBAAA4C,SAAA,CAAA7C,IAAA,GAAA6C,SAAA,CAAAT,EAAA,CAAAS,SAAA,aAGFjC,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAAgC,SAAA,CAAAT,EAAA,CAAQ,CAAC,wBAAAS,SAAA,CAAAP,IAAA,MAAAK,QAAA,gBAE7D,UAAAD,wBAAA,CAAA7D,KAAA,MAAAC,SAAA,WAGc,CAAAgD,aAAaA,CAAAoB,GAAA,CAAAC,IAAA,CAAAC,IAAA,CAAAC,IAAA,SAAAC,cAAA,CAAAzE,KAAA,MAAAC,SAAA,YAAAwE,eAAA,EAAAA,cAAA,CAAAvE,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAA5B,SAAAsE,SAA6BC,QAAQ,CAAErE,KAAK,CAAEG,QAAQ,CAAEC,QAAQ,MAAAC,OAAA,CAAAoC,QAAA,QAAA5C,mBAAA,GAAAa,IAAA,UAAA4D,UAAAC,SAAA,iBAAAA,SAAA,CAAA1D,IAAA,CAAA0D,SAAA,CAAAzD,IAAA,SACtDT,OAAO,CAAGrC,KAAK,CAAC+C,OAAO,CAAC,uBAAuB,CAAC,CACtDX,QAAQ,CAACjC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAACoG,SAAA,CAAA1D,IAAA,GAAA0D,SAAA,CAAAzD,IAAA,SAEN,CAAA5C,YAAY,CAAC,MAAM,CAAEI,iBAAiB,CAAE+F,QAAQ,CAAE,CACtElD,aAAa,WAAAC,MAAA,CAAWpB,KAAK,CACjC,CAAC,CAAC,QAFIyC,QAAQ,CAAA8B,SAAA,CAAAvD,IAAA,IAIVyB,QAAQ,CAACpB,IAAI,CAACC,OAAO,EAAAiD,SAAA,CAAAzD,IAAA,eACf,IAAI,CAAAS,KAAK,CAACkB,QAAQ,CAACpB,IAAI,CAACG,OAAO,CAAC,QAE1CxD,KAAK,CAACsD,OAAO,CAAC,mDAAmD,CAAC,CAClEnB,QAAQ,CAAC,6BAA6B,CAAC,CACvCC,QAAQ,CAAChC,SAAS,EAAE,CAAC,CAACmG,SAAA,CAAAzD,IAAA,kBAAAyD,SAAA,CAAA1D,IAAA,IAAA0D,SAAA,CAAAtB,EAAA,CAAAsB,SAAA,aAGtB9C,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAA6C,SAAA,CAAAtB,EAAA,CAAQ,CAC9CjF,KAAK,CAACiD,KAAK,CAAC,0BAA0B,CAAC,CAAC,QAE5CjD,KAAK,CAACkF,OAAO,CAAC7C,OAAO,CAAC,CACtBD,QAAQ,CAACjC,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAAC,yBAAAoG,SAAA,CAAApB,IAAA,MAAAiB,QAAA,iBACtC,UAAAD,cAAA,CAAAzE,KAAA,MAAAC,SAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}